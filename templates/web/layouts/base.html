{{define "base"}}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - OCC.IO.VN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'feng-gold': '#d4a574',
                        'feng-gold-light': '#e8c9a8',
                        'feng-gold-dark': '#b8926a',
                        'feng-earth': '#8b7355',
                        'feng-earth-dark': '#6b5344',
                        'feng-jade': '#2d6a4f',
                        'feng-jade-light': '#40916c',
                        'feng-jade-dark': '#1b4332',
                        'feng-cream': '#faf8f5',
                        'feng-sand': '#f5f0e8',
                    },
                    fontFamily: {
                        'serif': ['Georgia', 'Cambria', 'serif'],
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Source+Sans+3:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Source Sans 3', sans-serif; }
        .font-elegant { font-family: 'Cormorant Garamond', Georgia, serif; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .prose-feng h2 { font-family: 'Cormorant Garamond', serif; color: #2d6a4f; margin-top: 1.5em; margin-bottom: 0.5em; }
        .prose-feng p { margin-bottom: 1em; line-height: 1.7; }
        .prose-feng ul { list-style: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .prose-feng ol { list-style: decimal; padding-left: 1.5em; margin-bottom: 1em; }
        .prose-feng a { color: #2d6a4f; text-decoration: underline; }
        .prose-feng img { max-width: 100%; height: auto; border-radius: 0.5rem; }
    </style>
</head>
<body class="bg-feng-cream text-feng-earth-dark min-h-screen flex flex-col">
    {{template "navbar" .}}

    {{if .FlashSuccess}}
    <div class="fixed top-20 right-4 z-50 max-w-md animate-fade-in" id="flash-success">
        <div class="bg-feng-jade/95 text-white px-6 py-4 rounded-xl shadow-lg flex items-center justify-between gap-4 border border-feng-jade-light">
            <span class="flex items-center gap-2"><i class="fas fa-check-circle"></i> {{.FlashSuccess}}</span>
            <button onclick="this.closest('#flash-success').remove()" class="text-white/80 hover:text-white transition-colors">&times;</button>
        </div>
    </div>
    {{end}}
    {{if .FlashError}}
    <div class="fixed top-20 right-4 z-50 max-w-md animate-fade-in" id="flash-error">
        <div class="bg-red-600/95 text-white px-6 py-4 rounded-xl shadow-lg flex items-center justify-between gap-4 border border-red-500">
            <span class="flex items-center gap-2"><i class="fas fa-exclamation-circle"></i> {{.FlashError}}</span>
            <button onclick="this.closest('#flash-error').remove()" class="text-white/80 hover:text-white transition-colors">&times;</button>
        </div>
    </div>
    {{end}}

    <main class="flex-1">
        {{template "page_content" .}}
    </main>

    {{template "footer" .}}
    {{template "auth_modal" .}}

    <script>
        // Flash message auto-dismiss
        setTimeout(() => {
            document.querySelectorAll('#flash-success, #flash-error').forEach(el => {
                if (el) {
                    el.style.transition = 'opacity 0.5s';
                    el.style.opacity = '0';
                    setTimeout(() => el.remove(), 500);
                }
            });
        }, 5000);

        // Auth modal
        function openAuthModal(tab) {
            const modal = document.getElementById('authModal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                if (tab === 'register') {
                    document.getElementById('authTabRegister').click();
                } else {
                    document.getElementById('authTabLogin').click();
                }
            }
        }
        function closeAuthModal() {
            const modal = document.getElementById('authModal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }
        document.getElementById('authModal')?.addEventListener('click', function(e) {
            if (e.target === this) closeAuthModal();
        });

        // Cart functionality
        async function addToCart(productId, quantity = 1) {
            try {
                const fd = new FormData();
                fd.append('product_id', productId);
                fd.append('quantity', quantity);
                const res = await fetch('/cart/add', { method: 'POST', body: fd });
                const data = await res.json().catch(() => ({}));
                if (res.status === 401 || data.error === 'login_required') {
                    openAuthModal('login');
                    return;
                }
                if (data.status === 'ok' || res.ok) {
                    updateCartCount(data.cartCount || 0);
                    if (typeof showToast === 'function') showToast('Đã thêm vào giỏ hàng', 'success');
                    else alert('Đã thêm vào giỏ hàng');
                } else {
                    alert(data.error || data.message || 'Có lỗi xảy ra');
                }
            } catch (err) {
                console.error(err);
                alert('Có lỗi xảy ra');
            }
        }
        function updateCartCount(count) {
            const badge = document.getElementById('cartCountBadge');
            if (badge) {
                badge.textContent = count;
                badge.classList.toggle('hidden', count <= 0);
            }
        }
    </script>
</body>
</html>
{{end}}
